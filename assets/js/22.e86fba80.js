(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{446:function(e,s,t){"use strict";t.r(s);var r=t(17),a=Object(r.a)({},(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"sentry分享"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sentry分享"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://docs.sentry.io/",target:"_blank",rel:"noopener noreferrer"}},[e._v("sentry"),t("OutboundLink")],1),e._v("分享")]),e._v(" "),t("blockquote",[t("p",[e._v("应用监控平台。")])]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://www.fundebug.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("fundebug"),t("OutboundLink")],1)])]),e._v(" "),t("h2",{attrs:{id:"部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#部署"}},[e._v("#")]),e._v(" 部署")]),e._v(" "),t("h3",{attrs:{id:"必要条件（以最新sentry为例，旧版本sentry部署过程略有不同）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#必要条件（以最新sentry为例，旧版本sentry部署过程略有不同）"}},[e._v("#")]),e._v(" 必要条件（以最新sentry为例，旧版本sentry部署过程略有不同）")]),e._v(" "),t("ul",[t("li",[e._v("docker 17.05.0+")]),e._v(" "),t("li",[e._v("docker-compose 1.23.0+")]),e._v(" "),t("li",[e._v("python (建议3.0+)")]),e._v(" "),t("li",[e._v("git")]),e._v(" "),t("li",[e._v("2400MB RAM")])]),e._v(" "),t("h3",{attrs:{id:"过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#过程"}},[e._v("#")]),e._v(" 过程")]),e._v(" "),t("blockquote",[t("p",[e._v("安装注意事项git "),t("a",{attrs:{href:"https://github.com/getsentry/onpremise",target:"_blank",rel:"noopener noreferrer"}},[e._v("README"),t("OutboundLink")],1),e._v(" 简要介绍。docker、pip等需要配置下国内源，不然初始化镜像的时候非常慢")])]),e._v(" "),t("ol",[t("li",[e._v("进入任意安装目录，拉取sentry 安装git。"),t("code",[e._v("git clone https://github.com/getsentry/onpremise.git")])]),e._v(" "),t("li",[e._v("执行安装脚本。"),t("code",[e._v("sh ./install.sh")])]),e._v(" "),t("li",[e._v("运行docker。"),t("code",[e._v("docker-compose up -d")])])]),e._v(" "),t("h2",{attrs:{id:"配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[e._v("#")]),e._v(" 配置")]),e._v(" "),t("blockquote",[t("p",[e._v("配置文件：config.yml、sentry.conf.py、.env")])]),e._v(" "),t("h3",{attrs:{id:"邮件配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#邮件配置"}},[e._v("#")]),e._v(" 邮件配置")]),e._v(" "),t("ul",[t("li",[e._v("config.yml 文件配置邮件服务")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("  # mail.backend: 'smtp'  # Use dummy if you want to disable email entirely\n  mail.host: 'smtp.mxhichina.com' # 发送邮件smtp服务\n  mail.port: 80 # 发送邮件smtp服务端口\n  mail.username: 'tg.ding@js-datacraft.com' # 发送邮件smtp服务账号\n  mail.password: 'Dean1234' # 发送邮件smtp服务密码\n  mail.use-tls: true # 发送邮件smtp服务是否使用ssl服务\n  # The email address to send on behalf of\n  mail.from: 'tg.ding@js-datacraft.com'\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br")])]),t("h3",{attrs:{id:"创建超级用户"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建超级用户"}},[e._v("#")]),e._v(" 创建超级用户")]),e._v(" "),t("p",[t("code",[e._v("docker-compose run --rm web createuser --email admin888@example.com --password admin --superuser")])]),e._v(" "),t("h2",{attrs:{id:"使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[e._v("#")]),e._v(" 使用")]),e._v(" "),t("ul",[t("li",[e._v("初始化及手动上报文件")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("  import Vue from 'vue'\n  import * as Sentry from '@sentry/browser'\n  import { Vue as VueIntegration } from '@sentry/integrations'\n\n  const dsn = 'http://a089e9c7752c4b94a87c6dd1ec0d0a08@10.3.6.19:9000/2'\n\n  // main.js中初始化\n  Sentry.init({\n    dsn,\n    integrations: [new VueIntegration({ Vue, attachProps: true })]\n  })\n\n  // 手动上报：实例化Sentry\n  const client = new Sentry.BrowserClient({\n    dsn\n  })\n  const hub = new Sentry.Hub(client)\n  hub.captureException(error)\n\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br"),t("span",{staticClass:"line-number"},[e._v("12")]),t("br"),t("span",{staticClass:"line-number"},[e._v("13")]),t("br"),t("span",{staticClass:"line-number"},[e._v("14")]),t("br"),t("span",{staticClass:"line-number"},[e._v("15")]),t("br"),t("span",{staticClass:"line-number"},[e._v("16")]),t("br"),t("span",{staticClass:"line-number"},[e._v("17")]),t("br"),t("span",{staticClass:"line-number"},[e._v("18")]),t("br"),t("span",{staticClass:"line-number"},[e._v("19")]),t("br")])]),t("ul",[t("li",[e._v("上报设置")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("  // 配置额外上报信息，如请求url及参数等\n  hub.setExtra('config', config)\n  // 配置额外标签信息等\n  hub.addTag(\"tagName\", \"tagValue\");\n  // 配置额外的用户信息\n  hub.setUser('user', 'userInfo')\n  // 配置额外的错误等级\n  hub.setLevel('level', 'level')\n\n  // ...\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br")])]),t("h2",{attrs:{id:"原理浅析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#原理浅析"}},[e._v("#")]),e._v(" 原理浅析")]),e._v(" "),t("h3",{attrs:{id:"错误监听"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#错误监听"}},[e._v("#")]),e._v(" 错误监听")]),e._v(" "),t("ul",[t("li",[e._v("Sentry对"),t("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/GlobalEventHandlers/onerror",target:"_blank",rel:"noopener noreferrer"}},[e._v("window.onerror"),t("OutboundLink")],1),e._v("函数进行了改写，在这里实现了错误监控的逻辑，添加了很多运行时信息帮助进行错误定位。")]),e._v(" "),t("li",[e._v("在我们使用Promise的时候，如果发生错误而我们没有去catch的话，window.onerror是不能监控到这个错误的。JavaScript引擎会触发unhandledrejection事件，只要我们监听这个事件，那么就能够监控到Promise产生的错误。")])]),e._v(" "),t("h3",{attrs:{id:"错误处理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#错误处理"}},[e._v("#")]),e._v(" 错误处理")]),e._v(" "),t("ul",[t("li",[e._v("如果接收到的是一个ErrorEvent对象，那么直接取出它的error属性即可，这就是对应的error对象。")]),e._v(" "),t("li",[e._v("如果接收到的是一个DOMError或者DOMException，那么直接解析出name和message即可，因为这类错误通常是使用了已经废弃的DOMAPI导致的，并不会附带上错误堆栈信息。")]),e._v(" "),t("li",[e._v("如果接收到的是一个标准的错误对象，不做处理")]),e._v(" "),t("li",[e._v("如果接收到的是一个普通的JavaScript对象，Sentry会将这个对象的Key序列化为字符串，然后会触发报错 'Non-Error exception captured with keys: ' + serializeKeysForMessage(exKeys)")])]),e._v(" "),t("h2",{attrs:{id:"参考"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[e._v("#")]),e._v(" 参考")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/75577689",target:"_blank",rel:"noopener noreferrer"}},[e._v("浅谈Sentry前端监控原理"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/72451502",target:"_blank",rel:"noopener noreferrer"}},[e._v("Fundebug一步一步搭建前端监控系统：JS错误监控篇"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/32262716",target:"_blank",rel:"noopener noreferrer"}},[e._v("把前端监控做到极致"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=a.exports}}]);